<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Seneschal: Autonomous Personal Chief of Staff</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Chosen Palette: Warm Neutrals & Semantic Accents -->
    <!-- Background: Stone-50 (#fafaf9) to Stone-100 (#f5f5f4) -->
    <!-- Text: Stone-800 (#292524) -->
    <!-- Primary Brand/Action: Amber-600 (#d97706) -->
    <!-- Functional: Emerald-600 (Private/Safe), Blue-600 (Public/Cloud) -->

    <!-- Application Structure Plan:
         1. Hero Section: Immediate Value Prop (Chief of Staff).
         2. The Friction (Problem): Interactive cards highlighting the pain of independent contracting.
         3. The Architecture (Graph vs Vector): An interactive Chart.js visualization comparing "isolated vectors" to "connected knowledge graphs" to explain the 'Semantic Jump' concept.
         4. The Engine (Recursive Fixpoint): A custom Canvas animation demonstrating the cycle of 'Blind Spot Detection -> Link Up Search -> Ingestion -> Saturation'. This is the "Wow" factor.
         5. Privacy Sandbox: An interactive sorting simulation where users categorize data to see where it lives (Local vs. Cloud), reinforcing the privacy guarantee.
         6. Ecosystem & Ingestion: A functional list of supported inputs.
         
         Why this structure? It moves from "Why do I need this?" (Problem) to "How does it work?" (Architecture/Engine) to "Is it safe?" (Privacy), mirroring the user's mental evaluation process.
    -->

    <!-- Visualization & Content Choices:
         1. Problem Cards: Text + Unicode Icons. Goal: Empathy/Context.
         2. Graph vs Vector Viz: Chart.js Bubble/Scatter. Goal: Explain technical superiority. Interaction: Toggle View. Justification: Visualizes abstract data structures. NO SVG.
         3. Fixpoint Simulator: HTML5 Canvas (Custom). Goal: Explain the core algorithm. Interaction: Start/Stop. Justification: A loop is best shown with animation. NO SVG.
         4. Privacy Sorter: HTML/JS Grid. Goal: Trust. Interaction: Click to classify. Justification: Active participation reinforces the "Local First" rule.
    -->

    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->

    <style>
      body {
        font-family: "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        background-color: #fafaf9; /* stone-50 */
        color: #292524; /* stone-800 */
      }

      .section-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 4rem 1.5rem;
      }

      .card {
        background: white;
        border-radius: 0.75rem;
        box-shadow:
          0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
        transition:
          transform 0.2s,
          box-shadow 0.2s;
      }

      .card:hover {
        transform: translateY(-2px);
        box-shadow:
          0 10px 15px -3px rgba(0, 0, 0, 0.1),
          0 4px 6px -2px rgba(0, 0, 0, 0.05);
      }

      /* Chart Container Styling - Mandatory per instructions */
      .chart-container {
        position: relative;
        width: 100%;
        max-width: 800px; /* Constrain width for readability */
        height: 400px; /* Default height */
        max-height: 500px;
        margin-left: auto;
        margin-right: auto;
      }

      @media (max-width: 768px) {
        .chart-container {
          height: 300px;
        }
      }

      .btn-primary {
        background-color: #d97706; /* amber-600 */
        color: white;
        padding: 0.75rem 1.5rem;
        border-radius: 0.5rem;
        font-weight: 600;
        transition: background-color 0.2s;
        cursor: pointer;
        border: none;
      }
      .btn-primary:hover {
        background-color: #b45309; /* amber-700 */
      }

      .btn-outline {
        background-color: transparent;
        border: 2px solid #d97706;
        color: #d97706;
        padding: 0.75rem 1.5rem;
        border-radius: 0.5rem;
        font-weight: 600;
        transition: all 0.2s;
        cursor: pointer;
      }
      .btn-outline:hover {
        background-color: #d97706;
        color: white;
      }

      /* Custom scrollbar for text areas */
      .custom-scroll::-webkit-scrollbar {
        width: 8px;
      }
      .custom-scroll::-webkit-scrollbar-track {
        background: #f1f1f1;
      }
      .custom-scroll::-webkit-scrollbar-thumb {
        background: #d6d3d1;
        border-radius: 4px;
      }
      .custom-scroll::-webkit-scrollbar-thumb:hover {
        background: #a8a29e;
      }

      .step-indicator {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        margin-bottom: 0.5rem;
        transition: all 0.3s ease;
      }
    </style>
  </head>
  <body class="antialiased selection:bg-amber-200 selection:text-amber-900">
    <!-- Navigation -->
    <nav
      class="sticky top-0 z-50 bg-white/90 backdrop-blur-md border-b border-stone-200 shadow-sm"
    >
      <div
        class="max-width-container mx-auto px-6 py-4 flex justify-between items-center max-w-7xl"
      >
        <div
          class="text-2xl font-bold tracking-tight text-stone-800 flex items-center gap-2"
        >
          <span>‚ú¶</span> Seneschal
        </div>
        <div
          class="hidden md:flex space-x-8 text-sm font-medium text-stone-600"
        >
          <a href="#problem" class="hover:text-amber-600 transition-colors"
            >The Problem</a
          >
          <a href="#architecture" class="hover:text-amber-600 transition-colors"
            >Core Architecture</a
          >
          <a href="#process" class="hover:text-amber-600 transition-colors"
            >Recursive Engine</a
          >
          <a href="#privacy" class="hover:text-amber-600 transition-colors"
            >Privacy</a
          >
        </div>
        <button
          onclick="
            document
              .getElementById('problem')
              .scrollIntoView({ behavior: 'smooth' })
          "
          class="btn-primary text-sm"
        >
          Explore Logic
        </button>
      </div>
    </nav>

    <!-- Hero Section -->
    <header
      class="relative overflow-hidden bg-stone-100 border-b border-stone-200"
    >
      <div class="section-container flex flex-col items-center text-center">
        <div
          class="inline-block px-3 py-1 mb-4 text-xs font-semibold tracking-wider text-amber-600 uppercase bg-amber-100 rounded-full"
        >
          For Independent Contractors
        </div>
        <h1
          class="text-4xl md:text-6xl font-extrabold text-stone-900 mb-6 leading-tight"
        >
          Your Autonomous <br />
          <span
            class="text-transparent bg-clip-text bg-gradient-to-r from-amber-600 to-amber-800"
            >Personal Chief of Staff</span
          >
        </h1>
        <p
          class="max-w-2xl text-lg md:text-xl text-stone-600 mb-10 leading-relaxed"
        >
          Manage contracts, track constraints, and connect fragmented data.
          Seneschal is a centralized knowledge bank that maintains strict
          privacy while autonomously researching missing context to saturate
          your knowledge base.
        </p>
        <div class="flex flex-col sm:flex-row gap-4">
          <button onclick="scrollToSection('process')" class="btn-primary">
            See How It Works
          </button>
          <button onclick="scrollToSection('architecture')" class="btn-outline">
            Why Knowledge Graphs?
          </button>
        </div>
      </div>

      <!-- Abstract Decoration (Canvas) -->
      <canvas
        id="heroCanvas"
        class="absolute top-0 left-0 w-full h-full pointer-events-none opacity-20"
        style="z-index: 0"
      ></canvas>
    </header>

    <!-- Section 1: The Problem Space -->
    <section id="problem" class="bg-white py-20">
      <div class="section-container">
        <div class="text-center mb-16">
          <h2 class="text-3xl font-bold text-stone-800 mb-4">
            The Contractor's Dilemma
          </h2>
          <p class="max-w-2xl mx-auto text-stone-600">
            Independent work means managing your own infrastructure. Without a
            Chief of Staff, critical connections are lost in the noise.
          </p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
          <!-- Card 1 -->
          <div class="card p-8 border-t-4 border-red-400">
            <div class="text-4xl mb-4">üï∏Ô∏è</div>
            <h3 class="text-xl font-bold mb-3 text-stone-800">
              Complex Dependencies
            </h3>
            <p class="text-stone-600 leading-relaxed">
              Managing contracts isn't just about signing. It's about tracking
              overlapping constraints, deadlines, and multi-party relations that
              are hard to visualize.
            </p>
          </div>
          <!-- Card 2 -->
          <div class="card p-8 border-t-4 border-amber-400">
            <div class="text-4xl mb-4">üß©</div>
            <h3 class="text-xl font-bold mb-3 text-stone-800">
              Fragmented Data
            </h3>
            <p class="text-stone-600 leading-relaxed">
              Your "brain" is scattered: a PDF contract here, a Slack message
              there, an email thread somewhere else. No single source of truth
              exists.
            </p>
          </div>
          <!-- Card 3 -->
          <div class="card p-8 border-t-4 border-stone-400">
            <div class="text-4xl mb-4">üîç</div>
            <h3 class="text-xl font-bold mb-3 text-stone-800">
              The Context Gap
            </h3>
            <p class="text-stone-600 leading-relaxed">
              Traditional search keywords fail to connect private agreements
              with public knowledge. You miss the "why" and "how" behind your
              documents.
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- Section 2: Architecture (Vector vs Graph) -->
    <section
      id="architecture"
      class="bg-stone-50 py-20 border-y border-stone-200"
    >
      <div class="section-container">
        <div class="flex flex-col lg:flex-row gap-12 items-center">
          <!-- Text Content -->
          <div class="lg:w-1/3">
            <h2 class="text-3xl font-bold text-stone-800 mb-6">
              Beyond Simple Vectors: <br />The Knowledge Graph
            </h2>
            <p class="text-stone-600 mb-6">
              Most AI assistants use <strong>Vector Databases</strong>, which
              only capture similarity (e.g., "Contract" is close to
              "Agreement").
            </p>
            <p class="text-stone-600 mb-6">
              Seneschal uses a <strong>Structured Knowledge Graph</strong>. This
              captures higher-order relationships, allowing efficient traversal.
              A single "jump" in the graph can connect concepts that are
              semantically distant but logically related.
            </p>
            <div class="space-y-4">
              <div
                class="p-4 bg-white rounded-lg shadow-sm border border-stone-200 cursor-pointer hover:bg-amber-50 transition-colors"
                onclick="updateGraphViz('vector')"
              >
                <h4 class="font-bold text-stone-800">
                  Option A: Vector Database
                </h4>
                <p class="text-sm text-stone-500">
                  Points clustered by word similarity. No clear path from A to
                  B.
                </p>
              </div>
              <div
                class="p-4 bg-white rounded-lg shadow-sm border-l-4 border-amber-500 cursor-pointer hover:bg-amber-50 transition-colors"
                onclick="updateGraphViz('graph')"
              >
                <h4 class="font-bold text-stone-800">
                  Option B: Knowledge Graph
                </h4>
                <p class="text-sm text-stone-500">
                  Explicit connections. "Client X" ‚Üí signed ‚Üí "NDA Y" ‚Üí expires
                  ‚Üí "Date Z".
                </p>
              </div>
            </div>
          </div>

          <!-- Interactive Visualization -->
          <div class="lg:w-2/3 w-full bg-white p-6 rounded-xl shadow-lg">
            <div class="flex justify-between items-center mb-4">
              <h3 id="graphTitle" class="text-lg font-bold text-stone-700">
                Visualizing Data Relationships
              </h3>
              <div class="text-sm text-stone-500">
                <span
                  class="inline-block w-3 h-3 rounded-full bg-amber-500 mr-1"
                ></span>
                Entity
                <span
                  class="inline-block w-3 h-3 bg-stone-300 mr-1 ml-2"
                ></span>
                Connection
              </div>
            </div>
            <div class="chart-container">
              <canvas id="architectureChart"></canvas>
            </div>
            <p class="text-center text-sm text-stone-400 mt-4 italic">
              Switch views to see how Structure beats Similarity.
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- Section 3: The Recursive Fixpoint (The Engine) -->
    <section id="process" class="bg-white py-20">
      <div class="section-container">
        <div class="text-center mb-12">
          <span
            class="text-amber-600 font-bold tracking-wider uppercase text-sm"
            >The Engine</span
          >
          <h2 class="text-3xl font-bold text-stone-800 mt-2">
            The Recursive Fixpoint
          </h2>
          <p class="max-w-2xl mx-auto text-stone-600 mt-4">
            Seneschal doesn't just store data; it actively seeks to complete it.
            It cycles through detection, research, and ingestion until your
            knowledge base is saturated.
          </p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
          <!-- Simulation Controls & feedback -->
          <div>
            <div class="space-y-8">
              <div class="relative pl-8 border-l-2 border-stone-200">
                <div
                  class="step-indicator absolute -left-[21px] top-0 bg-stone-200 text-stone-600"
                  id="step-1-icon"
                >
                  1
                </div>
                <h4 class="text-xl font-bold text-stone-800">
                  Blind Spot Detection
                </h4>
                <p class="text-stone-600 mt-1">
                  Algorithm analyzes the graph for missing patterns (e.g., An
                  entity "Acme Corp" exists, but no industry or location data).
                </p>
              </div>

              <div class="relative pl-8 border-l-2 border-stone-200">
                <div
                  class="step-indicator absolute -left-[21px] top-0 bg-stone-200 text-stone-600"
                  id="step-2-icon"
                >
                  2
                </div>
                <h4 class="text-xl font-bold text-stone-800">
                  Link Up (External Search)
                </h4>
                <p class="text-stone-600 mt-1">
                  Queries public sources (News, Events, Press Releases) to fill
                  the identified gaps.
                </p>
              </div>

              <div class="relative pl-8 border-l-2 border-stone-200">
                <div
                  class="step-indicator absolute -left-[21px] top-0 bg-stone-200 text-stone-600"
                  id="step-3-icon"
                >
                  3
                </div>
                <h4 class="text-xl font-bold text-stone-800">
                  Recursive Integration
                </h4>
                <p class="text-stone-600 mt-1">
                  New data is ingested, creating new nodes. This might reveal
                  <em>new</em> blind spots, restarting the cycle.
                </p>
              </div>
            </div>

            <div
              class="mt-8 p-4 bg-stone-50 rounded-lg border border-stone-200"
            >
              <div class="flex justify-between items-center">
                <span class="font-bold text-stone-700"
                  >Status:
                  <span id="simStatus" class="text-amber-600">Idle</span></span
                >
                <button
                  id="startSimBtn"
                  class="btn-primary py-2 px-4 text-sm shadow-md hover:shadow-lg transform active:scale-95 transition-all"
                >
                  Start Saturation Cycle
                </button>
              </div>
              <div
                id="simLog"
                class="mt-3 h-24 overflow-y-auto text-xs font-mono text-stone-500 custom-scroll p-2 bg-white rounded border border-stone-100"
              >
                > System ready. Waiting for input...
              </div>
            </div>
          </div>

          <!-- Canvas Visualization of the Loop -->
          <div
            class="bg-stone-900 rounded-xl p-4 shadow-2xl relative overflow-hidden flex items-center justify-center"
            style="height: 400px"
          >
            <canvas id="fixpointCanvas" width="500" height="350"></canvas>
            <div class="absolute bottom-4 right-4 text-xs text-stone-400">
              Visualization: Recursive Knowledge Growth
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Section 4: Privacy & Security -->
    <section id="privacy" class="bg-stone-100 py-20 border-t border-stone-200">
      <div class="section-container">
        <div class="text-center mb-12">
          <h2 class="text-3xl font-bold text-stone-800">
            Strict Privacy Boundaries
          </h2>
          <p class="max-w-2xl mx-auto text-stone-600 mt-4">
            Your private documents never leave your local environment. Seneschal
            intelligently separates what must stay local from what can be
            augmented by the cloud.
          </p>
        </div>

        <!-- Privacy Interactive Sorter -->
        <div
          class="bg-white rounded-xl shadow-lg overflow-hidden max-w-4xl mx-auto"
        >
          <div
            class="p-6 border-b border-stone-200 bg-stone-50 flex justify-between items-center"
          >
            <h3 class="font-bold text-stone-700">
              Data Classification Simulator
            </h3>
            <p class="text-sm text-stone-500">
              Click a document to classify it.
            </p>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 h-96">
            <!-- Local Zone -->
            <div
              class="bg-emerald-50/50 p-6 border-r border-stone-100 relative group"
            >
              <div
                class="absolute top-4 left-4 text-emerald-700 font-bold flex items-center gap-2"
              >
                <span class="bg-emerald-200 p-1 rounded">üîí</span> Local /
                Private
              </div>
              <div class="mt-8 text-xs text-emerald-600 mb-4">
                Processed by Ollama (Local LLM). <br />Never sent to cloud APIs.
              </div>
              <div
                id="localZone"
                class="flex flex-wrap gap-2 content-start h-full pb-10 transition-all"
              >
                <!-- Items land here -->
              </div>
            </div>

            <!-- Cloud Zone -->
            <div class="bg-blue-50/50 p-6 relative group">
              <div
                class="absolute top-4 right-4 text-blue-700 font-bold flex items-center gap-2"
              >
                Cloud / Public <span class="bg-blue-200 p-1 rounded">‚òÅÔ∏è</span>
              </div>
              <div class="mt-8 text-xs text-blue-600 text-right mb-4">
                Processed by High-Power Cloud Models. <br />Public web data
                only.
              </div>
              <div
                id="cloudZone"
                class="flex flex-wrap gap-2 justify-end content-start h-full pb-10 transition-all"
              >
                <!-- Items land here -->
              </div>
            </div>
          </div>

          <!-- Document Pool -->
          <div class="p-6 bg-stone-800 text-center">
            <p class="text-stone-300 text-sm mb-4">
              Pending Documents (Click to Process):
            </p>
            <div id="docPool" class="flex flex-wrap justify-center gap-3">
              <!-- Generated by JS -->
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Section 5: Ingestion Support -->
    <section class="py-20 bg-white">
      <div class="section-container">
        <h2 class="text-2xl font-bold text-stone-800 mb-8 text-center">
          Intelligent Ingestion & Context
        </h2>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
          <div
            class="p-4 border rounded hover:border-amber-500 transition-colors"
          >
            <div class="text-2xl mb-2">üìÑ</div>
            <div class="font-bold text-stone-700">Contracts</div>
          </div>
          <div
            class="p-4 border rounded hover:border-amber-500 transition-colors"
          >
            <div class="text-2xl mb-2">üí∞</div>
            <div class="font-bold text-stone-700">Invoices</div>
          </div>
          <div
            class="p-4 border rounded hover:border-amber-500 transition-colors"
          >
            <div class="text-2xl mb-2">üìß</div>
            <div class="font-bold text-stone-700">Emails</div>
          </div>
          <div
            class="p-4 border rounded hover:border-amber-500 transition-colors"
          >
            <div class="text-2xl mb-2">üí¨</div>
            <div class="font-bold text-stone-700">Slack Msgs</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer class="bg-stone-900 text-stone-400 py-12">
      <div class="section-container text-center">
        <h2 class="text-2xl font-bold text-white mb-4">Seneschal</h2>
        <p class="max-w-md mx-auto mb-8">
          The recursive fixpoint for your personal knowledge base. Secure,
          autonomous, and intelligent.
        </p>
        <div class="text-sm">
          &copy; 2026 Seneschal Systems. Local-First Architecture.
        </div>
      </div>
    </footer>

    <!-- Scripts -->
    <script>
      // --- 1. Navigation Smooth Scroll ---
      function scrollToSection(id) {
        document.getElementById(id).scrollIntoView({ behavior: "smooth" });
      }

      // --- 2. Architecture Chart (Chart.js) ---
      // Comparison: Vector (Scatter) vs Graph (Connected)
      const ctxArch = document
        .getElementById("architectureChart")
        .getContext("2d");

      // Data points representing documents/entities
      const dataPoints = [
        { x: 10, y: 20, label: "Contract A" },
        { x: 15, y: 25, label: "Client X" },
        { x: 50, y: 50, label: "Invoice #001" },
        { x: 55, y: 55, label: "Payment" },
        { x: 80, y: 20, label: "NDA" },
        { x: 85, y: 15, label: "Legal Dept" },
        { x: 30, y: 80, label: "Email Thread" },
      ];

      let archChart = new Chart(ctxArch, {
        type: "bubble",
        data: {
          datasets: [
            {
              label: "Data Entities",
              data: dataPoints.map((p) => ({ x: p.x, y: p.y, r: 8 })),
              backgroundColor: "#d97706", // amber-600
              borderColor: "#fff",
              borderWidth: 2,
            },
          ],
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            x: { display: false, min: 0, max: 100 },
            y: { display: false, min: 0, max: 100 },
          },
          plugins: {
            tooltip: {
              callbacks: {
                label: function (context) {
                  return dataPoints[context.dataIndex].label;
                },
              },
            },
            legend: { display: false },
          },
        },
        plugins: [
          {
            id: "graphLines",
            beforeDraw: (chart) => {
              // This plugin draws lines between points ONLY in "Graph" mode
              if (chart.config.options.mode === "graph") {
                const ctx = chart.ctx;
                const meta = chart.getDatasetMeta(0);

                ctx.save();
                ctx.strokeStyle = "rgba(41, 37, 36, 0.2)"; // stone-800 low opacity
                ctx.lineWidth = 2;

                // Define connections (indices)
                const connections = [
                  [0, 1],
                  [2, 3],
                  [4, 5],
                  [1, 2],
                  [5, 0],
                  [6, 1],
                ];

                connections.forEach((pair) => {
                  const p1 = meta.data[pair[0]];
                  const p2 = meta.data[pair[1]];
                  if (p1 && p2) {
                    ctx.beginPath();
                    ctx.moveTo(p1.x, p1.y);
                    ctx.lineTo(p2.x, p2.y);
                    ctx.stroke();
                  }
                });
                ctx.restore();
              }
            },
          },
        ],
      });

      function updateGraphViz(mode) {
        const title = document.getElementById("graphTitle");
        if (mode === "vector") {
          title.innerText = "Vector Database View (Similarity Only)";
          archChart.options.mode = "vector";
          // Scramble positions slightly to show "loose" association
          archChart.data.datasets[0].data = dataPoints.map((p) => ({
            x: p.x + Math.random() * 5,
            y: p.y + Math.random() * 5,
            r: 8,
          }));
        } else {
          title.innerText = "Knowledge Graph View (Structured Relations)";
          archChart.options.mode = "graph";
          // Reset positions for structure
          archChart.data.datasets[0].data = dataPoints.map((p) => ({
            x: p.x,
            y: p.y,
            r: 10,
          }));
        }
        archChart.update();
      }

      // Initialize default
      archChart.options.mode = "vector";

      // --- 3. Recursive Fixpoint Simulator (Canvas) ---
      const fixCanvas = document.getElementById("fixpointCanvas");
      const fixCtx = fixCanvas.getContext("2d");
      const simStatus = document.getElementById("simStatus");
      const simLog = document.getElementById("simLog");
      const stepIcons = [
        document.getElementById("step-1-icon"),
        document.getElementById("step-2-icon"),
        document.getElementById("step-3-icon"),
      ];

      let simState = {
        nodes: [{ x: 250, y: 175, r: 20, type: "core", label: "User Data" }],
        rays: [], // Search beams
        activeStep: 0, // 0: Idle, 1: Detect, 2: Search, 3: Ingest
        running: false,
        iteration: 0,
      };

      function drawSim() {
        // Clear
        fixCtx.fillStyle = "#1c1917"; // stone-900
        fixCtx.fillRect(0, 0, fixCanvas.width, fixCanvas.height);

        // Draw Rays (Search)
        simState.rays.forEach((ray, index) => {
          fixCtx.beginPath();
          fixCtx.strokeStyle = `rgba(217, 119, 6, ${ray.opacity})`;
          fixCtx.lineWidth = 2;
          fixCtx.moveTo(ray.sx, ray.sy);
          fixCtx.lineTo(ray.ex, ray.ey);
          fixCtx.stroke();

          // Expand ray
          ray.ex += (ray.tx - ray.sx) * 0.1;
          ray.ey += (ray.ty - ray.sy) * 0.1;
          ray.opacity -= 0.02;

          if (ray.opacity <= 0) simState.rays.splice(index, 1);
        });

        // Draw Nodes
        simState.nodes.forEach((node) => {
          fixCtx.beginPath();
          fixCtx.arc(node.x, node.y, node.r, 0, Math.PI * 2);
          fixCtx.fillStyle = node.type === "core" ? "#d97706" : "#fff";
          fixCtx.fill();

          // Draw connections to core
          if (node.type !== "core") {
            fixCtx.beginPath();
            fixCtx.strokeStyle = "rgba(255,255,255,0.2)";
            fixCtx.lineWidth = 1;
            fixCtx.moveTo(250, 175);
            fixCtx.lineTo(node.x, node.y);
            fixCtx.stroke();
          }
        });

        // "Blind Spot" indicator (blinking red circle on core)
        if (simState.activeStep === 1) {
          fixCtx.beginPath();
          fixCtx.arc(
            250,
            175,
            30 + Math.sin(Date.now() / 100) * 5,
            0,
            Math.PI * 2,
          );
          fixCtx.strokeStyle = "rgba(239, 68, 68, 0.5)"; // red-500
          fixCtx.lineWidth = 2;
          fixCtx.stroke();
        }

        requestAnimationFrame(drawSim);
      }
      drawSim(); // Start render loop

      function log(msg) {
        const line = document.createElement("div");
        line.innerText = `> ${msg}`;
        simLog.appendChild(line);
        simLog.scrollTop = simLog.scrollHeight;
      }

      function highlightStep(stepNum) {
        stepIcons.forEach((icon, idx) => {
          if (idx + 1 === stepNum) {
            icon.classList.remove("bg-stone-200", "text-stone-600");
            icon.classList.add("bg-amber-600", "text-white", "scale-110");
          } else {
            icon.classList.add("bg-stone-200", "text-stone-600");
            icon.classList.remove("bg-amber-600", "text-white", "scale-110");
          }
        });
      }

      document.getElementById("startSimBtn").addEventListener("click", () => {
        if (simState.running) return;
        simState.running = true;
        simState.iteration = 0;
        runSimulationCycle();
      });

      function runSimulationCycle() {
        // STEP 1: DETECT
        simState.activeStep = 1;
        simStatus.innerText = "Detecting Blind Spots...";
        log("Analyzing Graph Structure...");
        highlightStep(1);

        setTimeout(() => {
          log("Blind spot found: Entity 'Client_Z' lacks industry context.");

          // STEP 2: SEARCH (Link Up)
          simState.activeStep = 2;
          simStatus.innerText = "Link Up: Searching Public Web...";
          highlightStep(2);

          // Spawn rays
          for (let i = 0; i < 5; i++) {
            const angle = Math.random() * Math.PI * 2;
            simState.rays.push({
              sx: 250,
              sy: 175,
              tx: 250 + Math.cos(angle) * 150,
              ty: 175 + Math.sin(angle) * 150,
              ex: 250,
              ey: 175,
              opacity: 1,
            });
          }

          setTimeout(() => {
            log("Found 3 relevant public records.");

            // STEP 3: INGEST
            simState.activeStep = 3;
            simStatus.innerText = "Ingesting & Linking...";
            highlightStep(3);

            // Add node
            const angle = Math.random() * Math.PI * 2;
            const dist = 60 + simState.iteration * 20;
            simState.nodes.push({
              x: 250 + Math.cos(angle) * dist,
              y: 175 + Math.sin(angle) * dist,
              r: 5 + Math.random() * 5,
              type: "new",
            });

            log("Knowledge Graph updated.");

            // Loop or Finish
            simState.iteration++;
            if (simState.iteration < 3) {
              setTimeout(runSimulationCycle, 1500);
            } else {
              simState.activeStep = 0;
              simState.running = false;
              simStatus.innerText = "Saturated (Fixpoint Reached)";
              simStatus.classList.replace("text-amber-600", "text-emerald-600");
              log("No further gaps detected. Fixpoint reached.");
              highlightStep(0);
            }
          }, 1500);
        }, 1500);
      }

      // --- 4. Privacy Sorter Game ---
      const docs = [
        { id: 1, name: "NDA_Signed.pdf", type: "private", emoji: "üîí" },
        { id: 2, name: "Company_News_RSS", type: "public", emoji: "üì∞" },
        { id: 3, name: "Bank_Statement.csv", type: "private", emoji: "üí≥" },
        { id: 4, name: "Event_Listing_Web", type: "public", emoji: "üìÖ" },
        { id: 5, name: "Client_Email.eml", type: "private", emoji: "üìß" },
        { id: 6, name: "Stock_Price_API", type: "public", emoji: "üìà" },
      ];

      const docPool = document.getElementById("docPool");
      const localZone = document.getElementById("localZone");
      const cloudZone = document.getElementById("cloudZone");

      function initSorter() {
        docPool.innerHTML = "";
        docs.forEach((doc) => {
          const btn = document.createElement("button");
          btn.className =
            "bg-stone-700 hover:bg-stone-600 text-white px-3 py-2 rounded text-xs transition-transform transform hover:scale-105 shadow-md flex items-center gap-2";
          btn.innerHTML = `${doc.emoji} ${doc.name}`;
          btn.onclick = () => sortDoc(doc, btn);
          docPool.appendChild(btn);
        });
      }

      function sortDoc(doc, btn) {
        btn.remove();

        // Create new element for zone
        const tag = document.createElement("div");
        tag.className = `px-3 py-2 rounded text-xs font-bold border flex items-center gap-2 animate-[pulse_0.5s_ease-in-out]`;
        tag.innerHTML = `${doc.emoji} ${doc.name}`;

        if (doc.type === "private") {
          tag.classList.add(
            "bg-white",
            "text-emerald-700",
            "border-emerald-200",
          );
          localZone.appendChild(tag);
        } else {
          tag.classList.add("bg-white", "text-blue-700", "border-blue-200");
          cloudZone.appendChild(tag);
        }
      }

      initSorter();

      // --- 5. Hero Canvas (Subtle Animation) ---
      const hCanvas = document.getElementById("heroCanvas");
      const hCtx = hCanvas.getContext("2d");
      let width, height;
      let hNodes = [];

      function resizeHero() {
        width = hCanvas.width = hCanvas.parentElement.offsetWidth;
        height = hCanvas.height = hCanvas.parentElement.offsetHeight;
        initHeroNodes();
      }
      window.addEventListener("resize", resizeHero);

      function initHeroNodes() {
        hNodes = [];
        for (let i = 0; i < 30; i++) {
          hNodes.push({
            x: Math.random() * width,
            y: Math.random() * height,
            vx: (Math.random() - 0.5) * 0.5,
            vy: (Math.random() - 0.5) * 0.5,
          });
        }
      }

      function animateHero() {
        hCtx.clearRect(0, 0, width, height);
        hCtx.fillStyle = "#d97706";
        hCtx.strokeStyle = "#d6d3d1"; // stone-300

        hNodes.forEach((node, i) => {
          node.x += node.vx;
          node.y += node.vy;

          if (node.x < 0 || node.x > width) node.vx *= -1;
          if (node.y < 0 || node.y > height) node.vy *= -1;

          hCtx.beginPath();
          hCtx.arc(node.x, node.y, 2, 0, Math.PI * 2);
          hCtx.fill();

          // Draw connections
          for (let j = i + 1; j < hNodes.length; j++) {
            const dx = hNodes[j].x - node.x;
            const dy = hNodes[j].y - node.y;
            const dist = Math.sqrt(dx * dx + dy * dy);
            if (dist < 100) {
              hCtx.beginPath();
              hCtx.globalAlpha = 1 - dist / 100;
              hCtx.moveTo(node.x, node.y);
              hCtx.lineTo(hNodes[j].x, hNodes[j].y);
              hCtx.stroke();
              hCtx.globalAlpha = 1;
            }
          }
        });
        requestAnimationFrame(animateHero);
      }

      resizeHero();
      animateHero();
    </script>
  </body>
</html>
